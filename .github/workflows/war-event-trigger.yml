name: War Event Trigger

on:
  schedule:
    - cron: '*/5 * * * *'   # ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Check time and send alert
        run: |
          # ‡πÄ‡∏ß‡∏•‡∏≤ UTC ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
          NOW_H=$(date -u +%H)
          NOW_M=$(date -u +%M)

          # ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢ (UTC+7)
          H=$(( (10#$NOW_H + 7) % 24 ))
          M=$((10#$NOW_M))

          # ==========================================
          # ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:
          # ‡∏ß‡∏≠‡∏ó‡∏∏‡∏Å 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (00,02,04,...)
          # ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ = ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Ñ‡∏µ‡πà
          # ‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏≤‡∏ó‡∏µ 30-34 (‡∏Å‡∏±‡∏ô‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå)
          # ==========================================

          if [ "$M" -ge 30 ] && [ "$M" -lt 35 ] && [ $((H % 2)) -eq 1 ]; then

            WAR_H=$((H + 1))
            if [ $WAR_H -eq 24 ]; then
              WAR_H=0
            fi

            PREV_H=$((WAR_H - 1))
            if [ $PREV_H -lt 0 ]; then
              PREV_H=23
            fi

            curl -H "Content-Type: application/json" \
                 -X POST \
                 -d "{
                   \"content\": \"‚öîÔ∏è ‡∏ß‡∏≠‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 30 ‡∏ô‡∏≤‡∏ó‡∏µ!\n\n‚è∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏°‡∏±‡∏Ñ‡∏£ Dojo ‡∏ó‡∏µ‡πà NPC BattleField\n‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏ß‡∏á 10 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\n\nüìå ‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏≠ ${WAR_H}:00 ‡∏à‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà ${PREV_H}:50\"
                 }" \
                 ${{ secrets.DISCORD_WEBHOOK }}

          fi
