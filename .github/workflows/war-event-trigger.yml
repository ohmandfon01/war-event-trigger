name: War Event Trigger

on:
  schedule:
    - cron: "*/5 * * * *"   # ทุก 5 นาที
  workflow_dispatch:

jobs:
  check-and-send:
    runs-on: ubuntu-latest
    steps:
      - name: Check time and send alert
        run: |
          NOW_UTC_H=$(date -u +%H)
          NOW_UTC_M=$(date -u +%M)

          # แปลงเป็นเวลาไทย
          H=$(( (10#$NOW_UTC_H + 7) % 24 ))
          M=$((10#$NOW_UTC_M))

          echo "Thai time: $H:$M"

          # ถ้านาที = 30 → เตือน
          if [ "$M" -eq 30 ]; then
            curl -H "Content-Type: application/json" \
            -X POST \
            -d "{\"content\":\"⚔️ อีก 30 นาทีจะถึงเวลาวอ! (วอ $(( (H+1)%24 )):00)\"}" \
            ${{ secrets.DISCORD_WEBHOOK }}
          else
            echo "ยังไม่ถึงเวลาเตือน"
          fi
