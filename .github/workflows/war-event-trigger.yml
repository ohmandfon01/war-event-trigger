name: War Event Trigger

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Check Thai time and notify
        run: |
          # ‡πÄ‡∏ß‡∏•‡∏≤ UTC
          UTC_H=$(date -u +%H)
          UTC_M=$(date -u +%M)

          # ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢ (UTC+7)
          H=$(( (10#$UTC_H + 7) % 24 ))
          M=$((10#$UTC_M))

          printf -v NOW "%02d:%02d" $H $M
          echo "Thai time: $NOW"

          # ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 30 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏≠
          if [ "$M" -eq 30 ] && [ $((H % 2)) -eq 1 ]; then

            WAR_H=$(( (H + 1) % 24 ))
            printf -v WAR_TIME "%02d:00" $WAR_H

            curl -H "Content-Type: application/json" \
              -X POST \
              -d "{\"content\":\"‚öîÔ∏è ‡∏≠‡∏µ‡∏Å 30 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏≠!\nüïí ‡∏ß‡∏≠‡∏£‡∏≠‡∏ö ${WAR_TIME}\"}" \
              ${{ secrets.DISCORD_WEBHOOK }}

          else
            echo "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"
          fi
