# Updated schedule trigger ‚öîÔ∏è (force reload)

name: War Event Trigger

on:
  schedule:
    - cron: "*/5 * * * *"   # ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ (UTC)
  workflow_dispatch:

permissions:
  contents: read

jobs:
  check-and-send:
    runs-on: ubuntu-latest

    steps:
      - name: Check time and send alert
        run: |
          echo "===== DEBUG TIME CHECK ====="

          NOW_UTC_H=$(date -u +%H)
          NOW_UTC_M=$(date -u +%M)

          # ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢ (UTC+7)
          H=$(( (10#$NOW_UTC_H + 7) % 24 ))
          M=$((10#$NOW_UTC_M))

          printf "Thai time now: %02d:%02d\n" $H $M

          if [ -z "${{ secrets.DISCORD_WEBHOOK }}" ]; then
            echo "‚ùå DISCORD_WEBHOOK is empty!"
            exit 1
          fi

          # ‡∏ñ‡πâ‡∏≤‡∏ô‡∏≤‡∏ó‡∏µ = 30 ‚Üí ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
          if [ "$M" -eq 30 ]; then

            NEXT_H=$(( (H + 1) % 24 ))
            printf "üöÄ Sending alert for war at %02d:00\n" $NEXT_H

            curl -s -o /dev/null -w "%{http_code}" \
              -H "Content-Type: application/json" \
              -X POST \
              -d "{\"content\":\"‚öîÔ∏è ‡∏≠‡∏µ‡∏Å 30 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏≠! (‡∏ß‡∏≠ ${NEXT_H}:00)\"}" \
              ${{ secrets.DISCORD_WEBHOOK }}

          else
            echo "‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"
          fi
